[server]
domain = grafana.smigula.io
root_url = https://grafana.smigula.io
serve_from_sub_path = true
protocol = http
enable_gzip = true

[security]
admin_user = mmurphy
# admin_password is set via environment variable
csrf_trusted_origins = https://grafana.smigula.io

[users]
allow_sign_up = false
allow_org_create = false

[auth]
disable_login_form = false
disable_signout_menu = false
oauth_allow_insecure_email_lookup = false

[auth.anonymous]
enabled = false
org_role = Viewer

[auth.generic_oauth]
enabled = true
name = Authentik
icon = signin
allow_sign_up = false
client_id = lxEIE09Ya7A8m2PSAIMpLVLMpFBtHQMwxLPC2KlE
# client_secret is set via environment variable
scopes = openid profile email
auth_url = https://auth.smigula.io/application/o/authorize/
token_url = https://auth.smigula.io/application/o/token/
api_url = https://auth.smigula.io/application/o/userinfo/
# Prevent the /emails endpoint issue
email_attribute_name = email
email_attribute_path = email
login_attribute_path = preferred_username
name_attribute_path = name
# Use ID token for attributes
use_id_token = true
id_token_attribute_name = email
# Role mapping based on Authentik groups
role_attribute_path = contains(groups[*], 'Grafana Admins') && 'Admin' || contains(groups[*], 'Grafana Editors') && 'Editor' || 'Viewer'
role_attribute_strict = false
# Additional settings
use_pkce = false
use_refresh_token = true
# TLS settings
tls_skip_verify_insecure = false
# Organization mapping
allow_assign_grafana_admin = true
skip_org_role_update_sync = false