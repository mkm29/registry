[server]
domain = grafana.smigula.io
root_url = https://grafana.smigula.io
serve_from_sub_path = true
protocol = http
enable_gzip = true

[security]
admin_user = mmurphy
# admin_password is set via environment variable
csrf_trusted_origins = https://grafana.smigula.io

[users]
allow_sign_up = false
allow_org_create = false

[auth]
disable_login_form = false
disable_signout_menu = false
oauth_allow_insecure_email_lookup = false

[auth.anonymous]
enabled = false
org_role = Viewer

[auth.generic_oauth]
enabled = false
name = Authentik
icon = signin
allow_sign_up = false
auto_login = false
client_id = lxEIE09Ya7A8m2PSAIMpLVLMpFBtHQMwxLPC2KlE
# client_secret is set via environment variable
scopes = openid profile email
empty_scopes = false
auth_url = https://auth.smigula.io/application/o/authorize/
token_url = https://auth.smigula.io/application/o/token/
# Commented out to prevent /emails endpoint bug in Grafana 12.0.2
# api_url = https://auth.smigula.io/application/o/userinfo/
# Disable teams/orgs to prevent additional API calls
teams_url = 
allowed_organizations =
# Map attributes from userinfo response
email_attribute_name = email
email_attribute_path = email
login_attribute_path = preferred_username
name_attribute_path = name
id_token_attribute_name = email
# Role mapping
role_attribute_path = contains(groups[*], 'Grafana Admins') && 'Admin' || contains(groups[*], 'Grafana Editors') && 'Editor' || 'Viewer'
role_attribute_strict = false
# Settings
use_pkce = false
use_refresh_token = true
allow_assign_grafana_admin = true
skip_org_role_update_sync = false
# Disable the userinfo endpoint and use ID token only
use_id_token = true

[auth.proxy]
enabled = true
header_name = X-authentik-username
header_property = username
auto_sign_up = true
sync_ttl = 60
whitelist = 172.24.0.0/16
headers = Email:X-authentik-email Name:X-authentik-name Groups:X-authentik-groups
enable_login_token = false